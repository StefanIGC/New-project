<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Test Grilă Medicină</title>
  <style>
    :root {
      --bg1: #0b1f2a;
      --bg2: #102a3a;
      --accent: #f29e38;
      --accent-2: #5eead4;
      --text: #f2f5f7;
      --muted: #a8b4bd;
      --card: rgba(255, 255, 255, 0.06);
      --ok: #22c55e;
      --bad: #ef4444;
      --shadow: 0 20px 60px rgba(0,0,0,0.35);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "IBM Plex Sans", "Segoe UI", system-ui, sans-serif;
      color: var(--text);
      background: radial-gradient(1200px 600px at 10% 10%, #16364a 0%, transparent 60%),
                  radial-gradient(1000px 800px at 90% 10%, #132f44 0%, transparent 55%),
                  linear-gradient(180deg, var(--bg1), var(--bg2));
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 32px 16px;
    }

    .app {
      width: min(1180px, 100%);
      display: grid;
      gap: 24px;
    }

    header {
      display: grid;
      gap: 8px;
    }

    .kicker {
      text-transform: uppercase;
      letter-spacing: 0.3em;
      font-size: 0.75rem;
      color: var(--accent-2);
    }

    h1 {
      font-family: "IBM Plex Serif", "Georgia", serif;
      font-weight: 600;
      margin: 0;
      font-size: clamp(2rem, 2vw + 1.6rem, 3rem);
    }

    .sub {
      margin: 0;
      color: var(--muted);
      max-width: 60ch;
      line-height: 1.5;
    }

    .panel {
      background: var(--card);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 20px;
      padding: clamp(20px, 4vw, 32px);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }

    .stats {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
    }

    .chip {
      border: 1px solid rgba(255,255,255,0.1);
      padding: 8px 12px;
      border-radius: 999px;
      font-size: 0.85rem;
      color: var(--muted);
      display: inline-flex;
      gap: 8px;
      align-items: center;
    }

    .chip strong { color: var(--text); }

    .question {
      font-size: 1.35rem;
      line-height: 1.4;
      margin: 16px 0 24px 0;
    }

    .answers {
      display: grid;
      gap: 12px;
    }

    .answer-btn {
      background: rgba(255,255,255,0.08);
      border: 1px solid transparent;
      border-radius: 14px;
      padding: 14px 16px;
      text-align: left;
      color: var(--text);
      font-size: 1rem;
      cursor: pointer;
      transition: transform 0.15s ease, border 0.15s ease, background 0.15s ease;
    }

    .answer-btn:hover {
      transform: translateY(-2px);
      border-color: rgba(255,255,255,0.2);
    }

    .answer-btn.correct {
      background: rgba(34, 197, 94, 0.2);
      border-color: rgba(34, 197, 94, 0.6);
    }

    .answer-btn.wrong {
      background: rgba(239, 68, 68, 0.2);
      border-color: rgba(239, 68, 68, 0.6);
    }

    .feedback {
      margin-top: 16px;
      min-height: 24px;
      font-size: 0.95rem;
    }

    .feedback.ok { color: var(--ok); }
    .feedback.bad { color: var(--bad); }

    .actions {
      margin-top: 24px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }

    .menu-grid {
      display: grid;
      gap: 20px;
      grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
    }

    .profile-card {
      display: grid;
      gap: 16px;
    }

    .profile-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .avatar {
      width: 72px;
      height: 72px;
      border-radius: 50%;
      background: rgba(255,255,255,0.12);
      display: grid;
      place-items: center;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.18);
      font-weight: 600;
      font-size: 1.1rem;
      color: var(--accent-2);
    }

    .avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .field {
      display: grid;
      gap: 8px;
    }

    .field label {
      font-size: 0.85rem;
      color: var(--muted);
    }

    .field input[type="text"],
    .field input[type="url"] {
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.14);
      border-radius: 10px;
      padding: 10px 12px;
      color: var(--text);
      font-size: 0.95rem;
    }

    .profile-edit.hidden {
      display: none;
    }

    .stats-list {
      display: grid;
      gap: 10px;
      margin-top: 8px;
    }

    .stat-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 12px;
      border-radius: 12px;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.12);
      font-size: 0.95rem;
    }

    .stat-item span {
      color: var(--muted);
      font-size: 0.85rem;
    }

    button.primary {
      background: var(--accent);
      color: #1b1b1b;
      border: none;
      border-radius: 999px;
      padding: 12px 20px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
      box-shadow: 0 10px 20px rgba(242, 158, 56, 0.3);
    }

    button.primary:hover { transform: translateY(-2px); }

    button.ghost {
      background: transparent;
      color: var(--text);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 999px;
      padding: 12px 20px;
      cursor: pointer;
    }

    .hidden { display: none; }

    .top-actions {
      display: flex;
      justify-content: flex-end;
    }

    .result {
      font-size: 1.2rem;
      line-height: 1.6;
      color: var(--muted);
    }

    .score {
      font-size: clamp(2.4rem, 2vw + 1.6rem, 3.2rem);
      color: var(--accent-2);
      font-weight: 600;
      margin: 12px 0 0 0;
    }

    @media (max-width: 640px) {
      .stats { flex-direction: column; align-items: flex-start; }
      .question { font-size: 1.2rem; }
      .menu-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="kicker">Test Grilă</div>
      <h1>Medic Pro 10</h1>
      <p class="sub">Alege răspunsul corect pentru fiecare întrebare. Vei primi exact 10 întrebări. La final primești nota și feedback.</p>
    </header>

    <section class="panel" id="menu-panel">
      <div class="stats">
        <div class="chip"><strong id="menu-q-count">10</strong> întrebări</div>
        <div class="chip">Timp: <strong>nelimitat</strong></div>
      </div>
      <div class="menu-grid">
        <div class="profile-card">
          <div class="stats">
            <div class="chip">Profil</div>
          </div>
          <div class="stats" style="justify-content:flex-start; gap:16px;">
            <div class="avatar" id="avatar">
              <span id="avatar-initials">MP</span>
            </div>
            <div>
              <div class="field">
                <label>Nume curent</label>
                <div id="name-display" style="font-weight:600;">-</div>
              </div>
            </div>
          </div>
          <div class="profile-actions">
            <button class="ghost" id="edit-profile-btn">Editează profil</button>
          </div>
          <div class="profile-edit hidden" id="profile-edit">
            <div class="field">
              <label for="name-input">Nume</label>
              <input id="name-input" type="text" placeholder="Ex: Maria Popescu" />
            </div>
            <div class="field">
              <label for="avatar-input">Imagine profil (jpg/png)</label>
              <input id="avatar-input" type="file" accept="image/*" />
            </div>
            <div class="actions" style="margin-top:8px;">
              <button class="ghost" id="save-profile-btn">Salvează</button>
              <button class="ghost" id="reset-profile-btn">Resetează</button>
              <button class="ghost" id="cancel-profile-btn">Anulează</button>
            </div>
          </div>
        </div>
        <div>
          <div class="stats">
            <div class="chip">Alege test</div>
          </div>
          <div class="field" style="margin-top:8px;">
            <label for="test-select">Test disponibil</label>
            <select id="test-select" style="background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.14); border-radius: 10px; padding: 10px 12px; color: var(--text); font-size: 0.95rem;">
            </select>
          </div>
          <div class="stats" style="margin-top:16px;">
            <div class="chip">Statistici note</div>
          </div>
          <div class="stats-list" id="stats-list"></div>
          <div class="actions">
            <button class="ghost" id="reset-stats-btn">Resetează statistica</button>
          </div>
        </div>
      </div>
      <div class="actions">
        <button class="primary" id="start-btn">Începe testul</button>
      </div>
    </section>

    <div class="top-actions hidden" id="abandon-wrap">
      <button class="ghost" id="abandon-btn">Abandonează</button>
    </div>
    <section class="panel hidden" id="quiz-panel">
      <div class="stats">
        <div class="chip">Întrebarea <strong id="q-index">1</strong> / <span id="q-total">10</span></div>
        <div class="chip">Scor curent: <strong id="score">0</strong></div>
      </div>
      <div class="question" id="question-text"></div>
      <div class="answers" id="answers"></div>
      <div class="feedback" id="feedback"></div>
      <div class="actions">
        <button class="primary hidden" id="next-btn">Următoarea întrebare</button>
      </div>
    </section>

    <section class="panel hidden" id="result-panel">
      <h2>Rezultat final</h2>
      <p class="result">Ai răspuns la toate întrebările.</p>
      <div class="score" id="final-score"></div>
      <p class="result" id="final-message"></p>
      <div class="actions">
        <button class="primary" id="menu-btn">Înapoi la meniu</button>
      </div>
    </section>
  </div>

  <script>
    const tests = [
      {
        id: "examen-national",
        name: "Examen național",
        questions: [
          {
            text: "Care este funcția principală a eritrocitelor?",
            options: [
              "Transportul oxigenului",
              "Coagularea sângelui",
              "Apărarea imună",
              "Secreția de hormoni"
            ],
            correct: 0
          },
          {
            text: "Ce structură este afectată în principal în astmul bronșic?",
            options: [
              "Bronhiile",
              "Alveolele",
              "Pleura",
              "Traheea"
            ],
            correct: 0
          },
          {
            text: "Care este valoarea aproximativă normală a frecvenței cardiace la adult, în repaus?",
            options: [
              "60-100 bătăi/min",
              "30-50 bătăi/min",
              "110-130 bătăi/min",
              "140-160 bătăi/min"
            ],
            correct: 0
          },
          {
            text: "Ce vitamină este esențială pentru coagularea sângelui?",
            options: [
              "Vitamina K",
              "Vitamina C",
              "Vitamina B12",
              "Vitamina D"
            ],
            correct: 0
          },
          {
            text: "Care este organul principal pentru detoxifierea medicamentelor?",
            options: [
              "Ficatul",
              "Rinichiul",
              "Inima",
              "Splina"
            ],
            correct: 0
          },
          {
            text: "Ce tip de microorganism cauzează tuberculoza?",
            options: [
              "Bacterie",
              "Virus",
              "Fung",
              "Parazit"
            ],
            correct: 0
          },
          {
            text: "Ce arteră este implicată în infarctul miocardic?",
            options: [
              "Arterele coronare",
              "Artera carotidă",
              "Artera femurală",
              "Artera renală"
            ],
            correct: 0
          },
          {
            text: "Care este unitatea funcțională a rinichiului?",
            options: [
              "Nefronul",
              "Neuronul",
              "Alveola",
              "Osteonul"
            ],
            correct: 0
          },
          {
            text: "Ce hormon scade glicemia?",
            options: [
              "Insulina",
              "Glucagonul",
              "Adrenalina",
              "Cortizolul"
            ],
            correct: 0
          },
          {
            text: "Care este principalul rol al plămânilor?",
            options: [
              "Schimbul de gaze (O2/CO2)",
              "Filtrarea sângelui",
              "Digestia grăsimilor",
              "Producerea de hormoni"
            ],
            correct: 0
          }
        ]
      },
      {
        id: "cardiologie",
        name: "Cardiologie",
        questions: [
          {
            text: "Ce arteră este implicată în infarctul miocardic?",
            options: [
              "Arterele coronare",
              "Artera carotidă",
              "Artera femurală",
              "Artera renală"
            ],
            correct: 0
          },
          {
            text: "Care este criteriul principal pentru diagnosticarea hipertensiunii arteriale?",
            options: [
              "Tensiune ≥ 140/90 mmHg la măsurători repetate",
              "Tensiune < 120/80 mmHg",
              "Tensiune 100/60 mmHg",
              "Tensiune 90/50 mmHg"
            ],
            correct: 0
          },
          {
            text: "Care este valoarea aproximativă normală a frecvenței cardiace la adult, în repaus?",
            options: [
              "60-100 bătăi/min",
              "30-50 bătăi/min",
              "110-130 bătăi/min",
              "140-160 bătăi/min"
            ],
            correct: 0
          },
          {
            text: "Ce hormon scade glicemia?",
            options: [
              "Insulina",
              "Glucagonul",
              "Adrenalina",
              "Cortizolul"
            ],
            correct: 0
          },
          {
            text: "Care este principalul rol al plămânilor?",
            options: [
              "Schimbul de gaze (O2/CO2)",
              "Filtrarea sângelui",
              "Digestia grăsimilor",
              "Producerea de hormoni"
            ],
            correct: 0
          },
          {
            text: "Ce tip de șoc se produce în anafilaxie?",
            options: [
              "Șoc distributiv",
              "Șoc cardiogen",
              "Șoc hipovolemic",
              "Șoc obstructiv"
            ],
            correct: 0
          }
        ]
      },
      {
        id: "nefrologie",
        name: "Nefrologie",
        questions: [
          {
            text: "Care este unitatea funcțională a rinichiului?",
            options: [
              "Nefronul",
              "Neuronul",
              "Alveola",
              "Osteonul"
            ],
            correct: 0
          },
          {
            text: "Care este organul principal pentru detoxifierea medicamentelor?",
            options: [
              "Ficatul",
              "Rinichiul",
              "Inima",
              "Splina"
            ],
            correct: 0
          },
          {
            text: "Ce examen paraclinic confirmă cel mai bine anemia feriprivă?",
            options: [
              "Feritină serică scăzută",
              "Leucocitoză",
              "Glicemie crescută",
              "Calcemie crescută"
            ],
            correct: 0
          },
          {
            text: "Care este rolul principal al trombocitelor?",
            options: [
              "Hemostaza (oprirea sângerării)",
              "Transportul oxigenului",
              "Imunitate celulară",
              "Conducerea impulsurilor nervoase"
            ],
            correct: 0
          },
          {
            text: "Ce tip de microorganism cauzează tuberculoza?",
            options: [
              "Bacterie",
              "Virus",
              "Fung",
              "Parazit"
            ],
            correct: 0
          }
        ]
      }
    ];

    const menuPanel = document.getElementById("menu-panel");
    const quizPanel = document.getElementById("quiz-panel");
    const resultPanel = document.getElementById("result-panel");

    const qIndexEl = document.getElementById("q-index");
    const qTotalEl = document.getElementById("q-total");
    const scoreEl = document.getElementById("score");
    const questionText = document.getElementById("question-text");
    const answersEl = document.getElementById("answers");
    const feedbackEl = document.getElementById("feedback");
    const nextBtn = document.getElementById("next-btn");
    const abandonWrap = document.getElementById("abandon-wrap");
    const abandonBtn = document.getElementById("abandon-btn");
    const finalScoreEl = document.getElementById("final-score");
    const finalMessageEl = document.getElementById("final-message");

    const nameInput = document.getElementById("name-input");
    const avatarInput = document.getElementById("avatar-input");
    const avatarEl = document.getElementById("avatar");
    const avatarInitials = document.getElementById("avatar-initials");
    const nameDisplay = document.getElementById("name-display");
    const profileEdit = document.getElementById("profile-edit");
    const editProfileBtn = document.getElementById("edit-profile-btn");
    const cancelProfileBtn = document.getElementById("cancel-profile-btn");
    const statsListEl = document.getElementById("stats-list");
    const testSelect = document.getElementById("test-select");
    const menuCountEl = document.getElementById("menu-q-count");

    let quizQuestions = [];
    let currentIndex = 0;
    let score = 0;
    let answered = false;
    let activeTest = tests[0];
    let profile = { name: "", avatar: "" };
    let stats = [];

    function shuffle(array) {
      return array
        .map(value => ({ value, sort: Math.random() }))
        .sort((a, b) => a.sort - b.sort)
        .map(({ value }) => value);
    }

    function loadState() {
      try {
        const storedProfile = JSON.parse(localStorage.getItem("med-quiz-profile"));
        const storedStats = JSON.parse(localStorage.getItem("med-quiz-stats"));
        const storedTest = localStorage.getItem("med-quiz-test");
        if (storedProfile) profile = storedProfile;
        if (Array.isArray(storedStats)) stats = storedStats;
        if (storedTest) {
          const found = tests.find(test => test.id === storedTest);
          if (found) activeTest = found;
        }
      } catch {
        profile = { name: "", avatar: "" };
        stats = [];
      }
    }

    function saveProfile() {
      localStorage.setItem("med-quiz-profile", JSON.stringify(profile));
    }

    function saveStats() {
      localStorage.setItem("med-quiz-stats", JSON.stringify(stats));
    }

    function setAvatarDisplay() {
      avatarEl.innerHTML = "";
      if (profile.avatar) {
        const img = document.createElement("img");
        img.src = profile.avatar;
        img.alt = "Avatar";
        avatarEl.appendChild(img);
      } else {
        const initials = profile.name
          ? profile.name
              .split(" ")
              .filter(Boolean)
              .slice(0, 2)
              .map(part => part[0].toUpperCase())
              .join("")
          : "MP";
        avatarInitials.textContent = initials;
        avatarEl.appendChild(avatarInitials);
      }
      nameDisplay.textContent = profile.name || "—";
    }

    function renderStats() {
      statsListEl.innerHTML = "";
      if (stats.length === 0) {
        const empty = document.createElement("div");
        empty.className = "stat-item";
        empty.textContent = "Nu există note salvate încă.";
        statsListEl.appendChild(empty);
        return;
      }
      stats.slice().reverse().forEach(entry => {
        const item = document.createElement("div");
        item.className = "stat-item";
        item.innerHTML = `<strong>${entry.score} / ${entry.total}</strong> <span>${entry.test} • ${entry.date}</span>`;
        statsListEl.appendChild(item);
      });
    }

    function showMenu() {
      quizPanel.classList.add("hidden");
      resultPanel.classList.add("hidden");
      abandonWrap.classList.add("hidden");
      menuPanel.classList.remove("hidden");
      nameInput.value = profile.name || "";
      setAvatarDisplay();
      renderStats();
      profileEdit.classList.add("hidden");
      renderTestSelect();
    }

    function startQuiz() {
      quizQuestions = shuffle(activeTest.questions);
      currentIndex = 0;
      score = 0;
      answered = false;
      scoreEl.textContent = score;
      qTotalEl.textContent = quizQuestions.length;
      menuPanel.classList.add("hidden");
      resultPanel.classList.add("hidden");
      abandonWrap.classList.remove("hidden");
      quizPanel.classList.remove("hidden");
      renderQuestion();
    }

    function renderQuestion() {
      const current = quizQuestions[currentIndex];
      qIndexEl.textContent = currentIndex + 1;
      questionText.textContent = current.text;
      feedbackEl.textContent = "";
      feedbackEl.className = "feedback";
      nextBtn.classList.add("hidden");
      answered = false;

      answersEl.innerHTML = "";
      current.options.forEach((option, index) => {
        const btn = document.createElement("button");
        btn.className = "answer-btn";
        btn.textContent = option;
        btn.addEventListener("click", () => handleAnswer(btn, index));
        answersEl.appendChild(btn);
      });
    }

    function handleAnswer(button, index) {
      if (answered) return;
      answered = true;

      const current = quizQuestions[currentIndex];
      const correctIndex = current.correct;
      const buttons = Array.from(answersEl.children);

      buttons.forEach((btn, idx) => {
        if (idx === correctIndex) {
          btn.classList.add("correct");
        }
      });

      if (index === correctIndex) {
        score += 1;
        scoreEl.textContent = score;
        feedbackEl.textContent = "Corect!";
        feedbackEl.classList.add("ok");
        setTimeout(goNext, 600);
      } else {
        button.classList.add("wrong");
        feedbackEl.textContent = `Greșit. Răspuns corect: ${current.options[correctIndex]}`;
        feedbackEl.classList.add("bad");
        nextBtn.classList.remove("hidden");
      }
    }

    function goNext() {
      if (currentIndex < quizQuestions.length - 1) {
        currentIndex += 1;
        renderQuestion();
      } else {
        showResult();
      }
    }

    function showResult() {
      quizPanel.classList.add("hidden");
      abandonWrap.classList.add("hidden");
      resultPanel.classList.remove("hidden");
      finalScoreEl.textContent = `Nota: ${score} / ${quizQuestions.length}`;
      const percent = Math.round((score / quizQuestions.length) * 100);
      if (percent >= 90) {
        finalMessageEl.textContent = "Excelent! Ai o bază solidă de cunoștințe medicale.";
      } else if (percent >= 70) {
        finalMessageEl.textContent = "Foarte bine! Mai rămân câteva detalii de fixat.";
      } else if (percent >= 50) {
        finalMessageEl.textContent = "Bine. Recomand să mai exersezi subiectele cheie.";
      } else {
        finalMessageEl.textContent = "Nu te descuraja. Revino după o recapitulare scurtă.";
      }
      addStatEntry();
    }

    function addStatEntry() {
      const now = new Date();
      const entry = {
        score,
        total: quizQuestions.length,
        test: activeTest.name,
        date: now.toLocaleDateString("ro-RO", {
          year: "numeric",
          month: "short",
          day: "2-digit"
        })
      };
      stats.push(entry);
      saveStats();
    }

    function renderTestSelect() {
      testSelect.innerHTML = "";
      tests.forEach(test => {
        const option = document.createElement("option");
        option.value = test.id;
        option.textContent = `${test.name} (${test.questions.length} întrebări)`;
        if (test.id === activeTest.id) option.selected = true;
        testSelect.appendChild(option);
      });
      menuCountEl.textContent = activeTest.questions.length;
    }

    document.getElementById("save-profile-btn").addEventListener("click", () => {
      profile.name = nameInput.value.trim();
      saveProfile();
      setAvatarDisplay();
      profileEdit.classList.add("hidden");
    });

    document.getElementById("reset-profile-btn").addEventListener("click", () => {
      profile = { name: "", avatar: "" };
      saveProfile();
      avatarInput.value = "";
      showMenu();
    });

    avatarInput.addEventListener("change", event => {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        profile.avatar = reader.result;
        saveProfile();
        setAvatarDisplay();
      };
      reader.readAsDataURL(file);
    });

    document.getElementById("reset-stats-btn").addEventListener("click", () => {
      stats = [];
      saveStats();
      renderStats();
    });

    testSelect.addEventListener("change", event => {
      const selected = tests.find(test => test.id === event.target.value);
      if (selected) {
        activeTest = selected;
        localStorage.setItem("med-quiz-test", selected.id);
        menuCountEl.textContent = selected.questions.length;
      }
    });

    editProfileBtn.addEventListener("click", () => {
      nameInput.value = profile.name || "";
      profileEdit.classList.remove("hidden");
    });

    cancelProfileBtn.addEventListener("click", () => {
      profileEdit.classList.add("hidden");
    });

    document.getElementById("start-btn").addEventListener("click", startQuiz);
    document.getElementById("next-btn").addEventListener("click", goNext);
    document.getElementById("menu-btn").addEventListener("click", showMenu);

    abandonBtn.addEventListener("click", () => {
      const ok = confirm("Vrei să abandonezi testul? Progresul curent se va pierde.");
      if (ok) showMenu();
    });

    loadState();
    showMenu();
  </script>
</body>
</html>
