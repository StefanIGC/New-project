<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hai Rodica ‚ù§Ô∏è</title>
  <style>
    :root {
      --bg1: #2a0f1e;
      --bg2: #3a1630;
      --accent: #f472b6;
      --accent-2: #f9a8d4;
      --text: #fff7fb;
      --muted: #f3cde0;
      --card: rgba(255, 255, 255, 0.08);
      --ok: #f472b6;
      --bad: #fb7185;
      --shadow: 0 20px 60px rgba(0,0,0,0.35);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "IBM Plex Sans", "Segoe UI", system-ui, sans-serif;
      color: var(--text);
      background: radial-gradient(1200px 600px at 10% 10%, #5b1d47 0%, transparent 60%),
                  radial-gradient(1000px 800px at 90% 10%, #4a1b3c 0%, transparent 55%),
                  linear-gradient(180deg, var(--bg1), var(--bg2));
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 32px 16px;
    }

    .app {
      width: min(1180px, 100%);
      display: grid;
      gap: 24px;
    }

    header {
      display: grid;
      gap: 8px;
    }

    .kicker {
      text-transform: uppercase;
      letter-spacing: 0.3em;
      font-size: 0.75rem;
      color: var(--accent-2);
    }

    h1 {
      font-family: "IBM Plex Serif", "Georgia", serif;
      font-weight: 600;
      margin: 0;
      font-size: clamp(2rem, 2vw + 1.6rem, 3rem);
    }

    .sub {
      margin: 0;
      color: var(--muted);
      max-width: 60ch;
      line-height: 1.5;
    }

    .panel {
      background: var(--card);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 20px;
      padding: clamp(20px, 4vw, 32px);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }

    .stats {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
    }

    .chip {
      border: 1px solid rgba(255,255,255,0.1);
      padding: 8px 12px;
      border-radius: 999px;
      font-size: 0.85rem;
      color: var(--muted);
      display: inline-flex;
      gap: 8px;
      align-items: center;
    }

    .chip strong { color: var(--text); }

    .question {
      font-size: 1.35rem;
      line-height: 1.4;
      margin: 16px 0 24px 0;
    }

    .answers {
      display: grid;
      gap: 12px;
    }

    .answer-btn {
      background: rgba(255,255,255,0.08);
      border: 1px solid transparent;
      border-radius: 14px;
      padding: 14px 16px;
      text-align: left;
      color: var(--text);
      font-size: 1rem;
      cursor: pointer;
      transition: transform 0.15s ease, border 0.15s ease, background 0.15s ease;
    }

    .answer-btn:hover {
      transform: translateY(-2px);
      border-color: rgba(255,255,255,0.2);
    }

    .answer-btn.correct {
      background: rgba(34, 197, 94, 0.2);
      border-color: rgba(34, 197, 94, 0.6);
    }

    .answer-btn.wrong {
      background: rgba(239, 68, 68, 0.2);
      border-color: rgba(239, 68, 68, 0.6);
    }

    .answer-btn.selected {
      border-color: rgba(255, 255, 255, 0.5);
      background: rgba(255, 255, 255, 0.14);
    }

    .feedback {
      margin-top: 16px;
      min-height: 24px;
      font-size: 0.95rem;
    }

    .feedback.ok { color: var(--ok); }
    .feedback.bad { color: var(--bad); }

    .actions {
      margin-top: 24px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }

    .menu-grid {
      display: grid;
      gap: 20px;
      grid-template-columns: minmax(0, 1fr);
    }

    .field {
      display: grid;
      gap: 8px;
    }

    .field label {
      font-size: 0.85rem;
      color: var(--muted);
    }

    .field input[type="text"],
    .field input[type="url"] {
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.14);
      border-radius: 10px;
      padding: 10px 12px;
      color: var(--text);
      font-size: 0.95rem;
    }

    .stats-list {
      display: grid;
      gap: 10px;
      margin-top: 8px;
    }

    .stat-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 12px;
      border-radius: 12px;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.12);
      font-size: 0.95rem;
    }

    .stat-item span {
      color: var(--muted);
      font-size: 0.85rem;
    }

    button.primary {
      background: var(--accent);
      color: #3b0a26;
      border: none;
      border-radius: 999px;
      padding: 12px 20px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
      box-shadow: 0 10px 20px rgba(242, 158, 56, 0.3);
    }

    button.primary:hover { transform: translateY(-2px); }

    button.ghost {
      background: transparent;
      color: var(--text);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 999px;
      padding: 12px 20px;
      cursor: pointer;
    }

    .hidden { display: none; }

    .top-actions {
      display: flex;
      justify-content: flex-end;
    }

    .result {
      font-size: 1.2rem;
      line-height: 1.6;
      color: var(--muted);
    }

    .score {
      font-size: clamp(2.4rem, 2vw + 1.6rem, 3.2rem);
      color: var(--accent-2);
      font-weight: 600;
      margin: 12px 0 0 0;
    }

    @media (max-width: 640px) {
      .stats { flex-direction: column; align-items: flex-start; }
      .question { font-size: 1.2rem; }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="kicker">Hai Rodica ‚ù§Ô∏è</div>
      <h1>Hai Rodica ‚ù§Ô∏è</h1>
      <p class="sub">Testele sunt pentru tine. Alege un test »ôi √Æncepe ‚Äî fiecare rƒÉspuns e un pas √Ænainte. E»ôti foarte bravo! üíñ</p>
    </header>

    <section class="panel" id="menu-panel">
      <div class="stats">
        <div class="chip"><strong id="menu-q-count">10</strong> √ÆntrebƒÉri</div>
        <div class="chip">Timp: <strong>nelimitat</strong></div>
      </div>
      <div class="menu-grid">
        <div>
          <div class="field">
            <label for="test-select">Test disponibil</label>
            <select id="test-select" style="background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.14); border-radius: 10px; padding: 10px 12px; color: var(--text); font-size: 0.95rem;">
            </select>
          </div>
          <div class="field" style="margin-top:12px;">
            <label for="limit-select">NumƒÉr √ÆntrebƒÉri √Æn test</label>
            <select id="limit-select" style="background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.14); border-radius: 10px; padding: 10px 12px; color: var(--text); font-size: 0.95rem;">
            </select>
          </div>
          <div class="stats" style="margin-top:16px;">
            <div class="chip">Statistici note</div>
          </div>
          <div class="stats-list" id="stats-list"></div>
          <div class="actions">
            <button class="ghost" id="reset-stats-btn">ReseteazƒÉ statistica</button>
          </div>
        </div>
      </div>
      <div class="actions">
        <button class="primary" id="start-btn">√éncepe testul</button>
      </div>
    </section>

    <div class="top-actions hidden" id="abandon-wrap">
      <button class="ghost" id="abandon-btn">AbandoneazƒÉ</button>
    </div>
    <section class="panel hidden" id="quiz-panel">
      <div class="stats">
        <div class="chip">√éntrebarea <strong id="q-index">1</strong> / <span id="q-total">10</span></div>
        <div class="chip">Scor curent: <strong id="score">0</strong></div>
      </div>
      <div class="sub" id="multi-hint" style="margin-top:12px; display:none;">SelecteazƒÉ toate rƒÉspunsurile corecte.</div>
      <div class="question" id="question-text"></div>
      <div class="answers" id="answers"></div>
      <div class="feedback" id="feedback"></div>
      <div class="actions">
        <button class="primary hidden" id="next-btn">UrmƒÉtoarea √Æntrebare</button>
        <button class="primary hidden" id="confirm-btn">ConfirmƒÉ rƒÉspunsul</button>
      </div>
    </section>

    <section class="panel hidden" id="result-panel">
      <h2>Rezultat final üíó</h2>
      <p class="result">Ai rƒÉspuns la toate √ÆntrebƒÉrile.</p>
      <div class="score" id="final-score"></div>
      <p class="result" id="final-message"></p>
      <div class="actions">
        <button class="primary" id="menu-btn">√énapoi la meniu</button>
      </div>
    </section>
  </div>

  <script>
    const testsIndexUrl = "tests/tests.json";
    let testsIndex = [];
    const testsById = new Map();

    const menuPanel = document.getElementById("menu-panel");
    const quizPanel = document.getElementById("quiz-panel");
    const resultPanel = document.getElementById("result-panel");

    const qIndexEl = document.getElementById("q-index");
    const qTotalEl = document.getElementById("q-total");
    const scoreEl = document.getElementById("score");
    const questionText = document.getElementById("question-text");
    const answersEl = document.getElementById("answers");
    const feedbackEl = document.getElementById("feedback");
    const nextBtn = document.getElementById("next-btn");
    const confirmBtn = document.getElementById("confirm-btn");
    const multiHintEl = document.getElementById("multi-hint");
    const abandonWrap = document.getElementById("abandon-wrap");
    const abandonBtn = document.getElementById("abandon-btn");
    const finalScoreEl = document.getElementById("final-score");
    const finalMessageEl = document.getElementById("final-message");

    const statsListEl = document.getElementById("stats-list");
    const testSelect = document.getElementById("test-select");
    const menuCountEl = document.getElementById("menu-q-count");
    const limitSelect = document.getElementById("limit-select");

    let quizQuestions = [];
    let currentIndex = 0;
    let score = 0;
    let answered = false;
    let activeTest = null;
    let activeTestMeta = null;
    let stats = [];
    let storedTestId = null;
    const allowedLimits = [10, 20, 50, 100, "toate"];
    let questionLimit = 20;
    let selectedIndices = new Set();
    const encouragements = [
      "Rodica, e»ôti foarte bravo! üíñ Stefan te iube»ôte. üå∏",
      "Rodica, e»ôti foarte bravo! üíó Stefan te iube»ôte. ‚ú®",
      "Rodica, e»ôti foarte bravo! üå∑ Stefan te iube»ôte. üíï",
      "Rodica, e»ôti foarte bravo! ü´∂ Stefan te iube»ôte. üåü",
      "Rodica, e»ôti foarte bravo! üíû Stefan te iube»ôte. üåº"
    ];

    function shuffle(array) {
      return array
        .map(value => ({ value, sort: Math.random() }))
        .sort((a, b) => a.sort - b.sort)
        .map(({ value }) => value);
    }

    function pickEncouragement() {
      return encouragements[Math.floor(Math.random() * encouragements.length)];
    }

    function getCorrectIndices(question) {
      if (Array.isArray(question.correct)) return question.correct.slice();
      if (typeof question.correct === "number") return [question.correct];
      return [];
    }

    async function loadTestsIndex() {
      const res = await fetch(testsIndexUrl, { cache: "no-store" });
      if (!res.ok) throw new Error("Nu pot √ÆncƒÉrca lista de teste.");
      testsIndex = await res.json();
    }

    async function loadTestById(id) {
      if (testsById.has(id)) return testsById.get(id);
      const meta = testsIndex.find(test => test.id === id);
      if (!meta) return null;
      const res = await fetch(`tests/${meta.file}`, { cache: "no-store" });
      if (!res.ok) throw new Error("Nu pot √ÆncƒÉrca testul selectat.");
      const data = await res.json();
      testsById.set(id, data);
      return data;
    }

    async function setActiveTest(id) {
      if (!id) return;
      const meta = testsIndex.find(test => test.id === id);
      if (!meta) return;
      activeTestMeta = meta;
      localStorage.setItem("med-quiz-test", meta.id);
      menuCountEl.textContent = meta.count;
      renderStats();
      renderLimitSelect();
      activeTest = await loadTestById(meta.id);
    }

    function loadState() {
      try {
        const storedStats = JSON.parse(localStorage.getItem("med-quiz-stats"));
        const storedTest = localStorage.getItem("med-quiz-test");
        const storedLimit = localStorage.getItem("med-quiz-limit");
        if (Array.isArray(storedStats)) stats = storedStats;
        if (storedTest) storedTestId = storedTest;
        if (storedLimit) questionLimit = storedLimit === "toate" ? "toate" : Number(storedLimit);
      } catch {
        stats = [];
      }
    }

    function saveStats() {
      localStorage.setItem("med-quiz-stats", JSON.stringify(stats));
    }

    function renderStats() {
      if (!activeTestMeta) return;
      const filtered = stats.filter(entry => entry.testId === activeTestMeta.id);
      statsListEl.innerHTML = "";
      if (filtered.length === 0) {
        const empty = document.createElement("div");
        empty.className = "stat-item";
        empty.textContent = "Nu existƒÉ note salvate √ÆncƒÉ pentru acest test.";
        statsListEl.appendChild(empty);
        return;
      }
      filtered.slice().reverse().forEach(entry => {
        const item = document.createElement("div");
        item.className = "stat-item";
        item.innerHTML = `<strong>${entry.score} / ${entry.total}</strong> <span>${entry.date}</span>`;
        statsListEl.appendChild(item);
      });
    }

    function showMenu() {
      quizPanel.classList.add("hidden");
      resultPanel.classList.add("hidden");
      abandonWrap.classList.add("hidden");
      menuPanel.classList.remove("hidden");
      renderStats();
      renderTestSelect();
    }

    async function startQuiz() {
      if (!activeTest) {
        await setActiveTest(activeTestMeta?.id || testsIndex[0]?.id);
      }
      if (!activeTest) return;
      const total = activeTest.questions.length;
      const limit = questionLimit === "toate" ? total : Math.min(questionLimit, total);
      quizQuestions = shuffle(activeTest.questions).slice(0, limit);
      currentIndex = 0;
      score = 0;
      answered = false;
      scoreEl.textContent = score;
      qTotalEl.textContent = quizQuestions.length;
      menuPanel.classList.add("hidden");
      resultPanel.classList.add("hidden");
      abandonWrap.classList.remove("hidden");
      quizPanel.classList.remove("hidden");
      renderQuestion();
    }

    function renderQuestion() {
      const current = quizQuestions[currentIndex];
      const correctIndices = getCorrectIndices(current);
      const isMulti = correctIndices.length > 1;
      qIndexEl.textContent = currentIndex + 1;
      questionText.textContent = current.text;
      feedbackEl.textContent = "";
      feedbackEl.className = "feedback";
      nextBtn.classList.add("hidden");
      confirmBtn.classList.add("hidden");
      multiHintEl.style.display = isMulti ? "block" : "none";
      answered = false;
      selectedIndices = new Set();

      answersEl.innerHTML = "";
      current.options.forEach((option, index) => {
        const btn = document.createElement("button");
        btn.className = "answer-btn";
        btn.textContent = option;
        btn.addEventListener("click", () => handleAnswer(btn, index, isMulti));
        answersEl.appendChild(btn);
      });
      if (isMulti) confirmBtn.classList.remove("hidden");
    }

    function handleAnswer(button, index, isMulti) {
      if (answered) return;
      const current = quizQuestions[currentIndex];
      const correctIndices = getCorrectIndices(current);
      const buttons = Array.from(answersEl.children);

      if (isMulti) {
        if (selectedIndices.has(index)) {
          selectedIndices.delete(index);
          button.classList.remove("selected");
        } else {
          selectedIndices.add(index);
          button.classList.add("selected");
        }
        return;
      }

      answered = true;
      buttons.forEach((btn, idx) => {
        if (correctIndices.includes(idx)) {
          btn.classList.add("correct");
        }
      });

      if (correctIndices.includes(index)) {
        score += 1;
        scoreEl.textContent = score;
        feedbackEl.textContent = `Corect! ${pickEncouragement()}`;
        feedbackEl.classList.add("ok");
        setTimeout(goNext, 600);
      } else {
        button.classList.add("wrong");
        const correctText = correctIndices.map(i => current.options[i]).join(", ");
        feedbackEl.textContent = `Gre»ôit. RƒÉspuns corect: ${correctText}. ${pickEncouragement()}`;
        feedbackEl.classList.add("bad");
        nextBtn.classList.remove("hidden");
      }
    }

    function confirmMultiAnswer() {
      if (answered) return;
      const current = quizQuestions[currentIndex];
      const correctIndices = getCorrectIndices(current).sort();
      const selected = Array.from(selectedIndices).sort();
      const buttons = Array.from(answersEl.children);
      answered = true;

      buttons.forEach((btn, idx) => {
        if (correctIndices.includes(idx)) {
          btn.classList.add("correct");
        }
      });

      const isCorrect = correctIndices.length === selected.length &&
        correctIndices.every((value, idx) => value === selected[idx]);

      if (isCorrect) {
        score += 1;
        scoreEl.textContent = score;
        feedbackEl.textContent = `Corect! ${pickEncouragement()}`;
        feedbackEl.classList.add("ok");
        setTimeout(goNext, 600);
      } else {
        selected.forEach(i => {
          if (!correctIndices.includes(i)) {
            buttons[i].classList.add("wrong");
          }
        });
        const correctText = correctIndices.map(i => current.options[i]).join(", ");
        feedbackEl.textContent = `Gre»ôit. RƒÉspuns corect: ${correctText}. ${pickEncouragement()}`;
        feedbackEl.classList.add("bad");
        nextBtn.classList.remove("hidden");
      }
    }

    function goNext() {
      if (currentIndex < quizQuestions.length - 1) {
        currentIndex += 1;
        renderQuestion();
      } else {
        showResult();
      }
    }

    function showResult() {
      quizPanel.classList.add("hidden");
      abandonWrap.classList.add("hidden");
      resultPanel.classList.remove("hidden");
      finalScoreEl.textContent = `Nota: ${score} / ${quizQuestions.length}`;
      const percent = Math.round((score / quizQuestions.length) * 100);
      if (percent >= 90) {
        finalMessageEl.textContent = `Excelent! ${pickEncouragement()} üéâ`;
      } else if (percent >= 70) {
        finalMessageEl.textContent = `Foarte bine! ${pickEncouragement()} üí™`;
      } else if (percent >= 50) {
        finalMessageEl.textContent = `Bine! ${pickEncouragement()} üìö`;
      } else {
        finalMessageEl.textContent = `Nu te descuraja. ${pickEncouragement()} üåà`;
      }
      addStatEntry();
    }

    function addStatEntry() {
      const now = new Date();
      const entry = {
        score,
        total: quizQuestions.length,
        testId: activeTest.id,
        test: activeTest.name,
        date: now.toLocaleDateString("ro-RO", {
          year: "numeric",
          month: "short",
          day: "2-digit"
        })
      };
      stats.push(entry);
      saveStats();
    }

    function renderTestSelect() {
      testSelect.innerHTML = "";
      testsIndex.forEach(test => {
        const option = document.createElement("option");
        option.value = test.id;
        option.textContent = `${test.name} (${test.count} √ÆntrebƒÉri)`;
        if (activeTestMeta && test.id === activeTestMeta.id) option.selected = true;
        testSelect.appendChild(option);
      });
      if (activeTestMeta) menuCountEl.textContent = activeTestMeta.count;
    }

    function renderLimitSelect() {
      const total = activeTestMeta ? activeTestMeta.count : 0;
      limitSelect.innerHTML = "";
      allowedLimits.forEach(value => {
        const option = document.createElement("option");
        const isAll = value === "toate";
        option.value = String(value);
        option.textContent = isAll ? "Toate" : `${value}`;
        if (!isAll && total && value > total) option.disabled = true;
        if (String(questionLimit) === String(value)) option.selected = true;
        limitSelect.appendChild(option);
      });
    }

    document.getElementById("reset-stats-btn").addEventListener("click", () => {
      stats = [];
      saveStats();
      renderStats();
    });

    testSelect.addEventListener("change", async event => {
      await setActiveTest(event.target.value);
    });

    limitSelect.addEventListener("change", event => {
      const value = event.target.value;
      questionLimit = value === "toate" ? "toate" : Number(value);
      localStorage.setItem("med-quiz-limit", String(value));
    });

    document.getElementById("start-btn").addEventListener("click", () => {
      startQuiz();
    });
    document.getElementById("next-btn").addEventListener("click", goNext);
    confirmBtn.addEventListener("click", confirmMultiAnswer);
    document.getElementById("menu-btn").addEventListener("click", showMenu);

    abandonBtn.addEventListener("click", () => {
      const ok = confirm("Vrei sƒÉ abandonezi testul? Progresul curent se va pierde.");
      if (ok) showMenu();
    });

    async function init() {
      loadState();
      try {
        await loadTestsIndex();
        const initialId = storedTestId || testsIndex[0]?.id;
        await setActiveTest(initialId);
        renderLimitSelect();
        showMenu();
      } catch (err) {
        console.error(err);
        alert("Nu s-au putut √ÆncƒÉrca testele. VerificƒÉ dacƒÉ fi»ôierele existƒÉ.");
      }
    }

    init();
  </script>
</body>
</html>
